<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BNI TRES STELLAS 1to1ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            font-weight: 300;
            margin-bottom: 10px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 380px 1fr;
            height: calc(100vh - 200px);
        }
        
        .sidebar {
            background: #f8f9fa;
            padding: 30px;
            border-right: 1px solid #e9ecef;
            overflow-y: auto;
        }
        
        .search-section {
            margin-bottom: 20px;
        }
        
        .search-box {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 16px;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }
        
        .search-box:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .search-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }
        
        .search-tab {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 15px;
            background: #e9ecef;
            color: #495057;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .search-tab.active {
            background: #3498db;
            color: white;
        }
        
        .filter-section {
            margin-bottom: 20px;
        }
        
        .filter-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
            font-size: 14px;
        }
        
        .filter-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .filter-btn {
            padding: 6px 12px;
            border: 2px solid #e9ecef;
            background: white;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .filter-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .management-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f1f3f4;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        
        .management-btn {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: none;
            border-radius: 8px;
            background: #3498db;
            color: white;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
        }
        
        .management-btn:hover {
            background: #2980b9;
        }
        
        .management-btn.delete {
            background: #e74c3c;
        }
        
        .management-btn.delete:hover {
            background: #c0392b;
        }
        
        .add-form {
            margin-top: 15px;
            display: none;
        }
        
        .add-form.show {
            display: block;
        }
        
        .form-input-small {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .form-buttons {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }
        
        .btn-save {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            flex: 1;
        }
        
        .btn-cancel {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            flex: 1;
        }
        
        .file-upload {
            margin-top: 15px;
            display: none;
        }
        
        .file-upload.show {
            display: block;
        }
        
        .file-area {
            border: 2px dashed #ddd;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px 0;
        }
        
        .file-area:hover {
            border-color: #3498db;
        }
        
        .delete-form {
            margin-top: 15px;
            display: none;
            background: #fff5f5;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #fed7d7;
        }
        
        .delete-form.show {
            display: block;
        }
        
        .delete-warning {
            color: #e53e3e;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .member-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 10px;
        }
        
        .member-item {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .member-item:hover {
            background: #e3f2fd;
        }
        
        .member-item.selected {
            background: #3498db;
            color: white;
        }
        
        .member-item.completed {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }
        
        .member-info {
            flex: 1;
            pointer-events: none;
        }
        
        .member-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .member-category {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 3px;
        }
        
        .member-id {
            font-size: 0.8em;
            color: #999;
        }
        
        .member-actions {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e9ecef;
        }
        
        .status-indicator.completed {
            background: #28a745;
        }
        
        .status-indicator.scheduled {
            background: #ffc107;
        }
        
        .delete-member-btn {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 12px;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            margin-left: 8px;
        }
        
        .delete-member-btn:hover {
            background: #c0392b;
            transform: scale(1.1);
        }
        
        .delete-mode .delete-member-btn {
            display: flex;
        }
        
        .bulk-delete-mode .member-checkbox {
            display: block;
        }
        
        .member-checkbox {
            display: none;
            margin-right: 10px;
            transform: scale(1.2);
        }
        
        .detail-panel {
            padding: 30px;
            overflow-y: auto;
        }
        
        .welcome-message {
            text-align: center;
            color: #666;
            font-size: 1.2em;
            margin-top: 100px;
        }
        
        .member-detail {
            display: none;
        }
        
        .member-detail.active {
            display: block;
        }
        
        .detail-header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            position: relative;
        }
        
        .detail-name {
            font-size: 2em;
            font-weight: 300;
            margin-bottom: 10px;
        }
        
        .detail-category {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .back-btn {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .delete-current-member-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .delete-current-member-btn:hover {
            background: #c0392b;
        }
        
        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
        }
        
        .form-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c3e50;
        }
        
        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .quick-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .quick-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            background: #e9ecef;
            color: #495057;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .quick-btn:hover {
            background: #3498db;
            color: white;
        }
        
        .save-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 20px;
        }
        
        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(40, 167, 69, 0.3);
        }
        
        .progress-bar {
            background: #e9ecef;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #28a745, #20c997);
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .export-section {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: #e3f2fd;
            border-radius: 10px;
        }
        
        .export-btn {
            background: linear-gradient(135deg, #2196f3 0%, #21cbf3 100%);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 20px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(33, 150, 243, 0.3);
        }
        
        /* ç”»åƒé–¢é€£ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .image-upload-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .image-slot {
            position: relative;
            border: 2px dashed #ddd;
            border-radius: 10px;
            overflow: hidden;
            min-height: 150px;
        }
        
        .image-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            cursor: pointer;
            height: 150px;
            transition: all 0.3s ease;
        }
        
        .image-placeholder:hover {
            background: #f8f9fa;
            border-color: #3498db;
        }
        
        .upload-icon {
            font-size: 2em;
            margin-bottom: 10px;
            opacity: 0.5;
        }
        
        .uploaded-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            cursor: pointer;
        }
        
        .image-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: space-around;
            padding: 5px;
        }
        
        .image-btn {
            background: none;
            border: none;
            color: white;
            font-size: 12px;
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
            transition: background 0.3s ease;
        }
        
        .image-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .image-info {
            text-align: center;
            color: #666;
            font-size: 12px;
        }
        
        /* ç”»åƒãƒ¢ãƒ¼ãƒ€ãƒ« */
        .image-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            cursor: pointer;
        }
        
        .image-modal img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }
        
        .close-modal {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            cursor: pointer;
        }

        /* ãƒãƒƒãƒãƒ³ã‚°æ©Ÿèƒ½ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .matching-placeholder {
            text-align: center;
            color: #999;
            font-style: italic;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px dashed #ddd;
        }
        
        .matching-results {
            display: grid;
            gap: 15px;
        }
        
        .matching-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .matching-card:hover {
            border-color: #3498db;
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.1);
            transform: translateY(-2px);
        }
        
        .matching-card.high-match {
            border-color: #28a745;
            background: #f8fff9;
        }
        
        .matching-card.medium-match {
            border-color: #ffc107;
            background: #fffef8;
        }
        
        .matching-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .matching-name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1em;
        }
        
        .matching-score {
            background: #3498db;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }
        
        .matching-score.high {
            background: #28a745;
        }
        
        .matching-score.medium {
            background: #ffc107;
            color: #000;
        }
        
        .matching-category {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 8px;
        }
        
        .matching-reason {
            background: #e3f2fd;
            padding: 8px 10px;
            border-radius: 6px;
            font-size: 0.85em;
            color: #1565c0;
            margin-bottom: 8px;
        }
        
        .matching-reason.wants {
            background: #e8f5e8;
            color: #2e7d32;
        }
        
        .matching-reason.offers {
            background: #fff3e0;
            color: #ef6c00;
        }
        
        .matching-keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 5px;
        }
        
        .matching-keyword {
            background: #f1f3f4;
            color: #495057;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 0.75em;
        }
        
        .matching-keyword.highlight {
            background: #3498db;
            color: white;
        }
        
        .no-matches {
            text-align: center;
            color: #666;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            font-style: italic;
        }

        .empty-state {
            text-align: center;
            color: #666;
            padding: 40px 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 20px 0;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .empty-state p {
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .empty-state-btn {
            background: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .empty-state-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .sidebar {
                padding: 20px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .image-upload-area {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤ BNI TRES STELLAS 1to1ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalMembers">0</div>
                    <div class="stat-label">ç·ãƒ¡ãƒ³ãƒãƒ¼</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="completedCount">0</div>
                    <div class="stat-label">å®Œäº†æ¸ˆã¿</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="scheduledCount">0</div>
                    <div class="stat-label">äºˆå®šæ¸ˆã¿</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="progressPercent">0%</div>
                    <div class="stat-label">é€²æ—ç‡</div>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar" style="width: 0%"></div>
            </div>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <div class="search-section">
                    <div class="search-tabs">
                        <button class="search-tab active" id="basicSearch">åŸºæœ¬æ¤œç´¢</button>
                        <button class="search-tab" id="wantsSearch">ç´¹ä»‹ã—ã¦ã»ã—ã„</button>
                        <button class="search-tab" id="offersSearch">ç´¹ä»‹ã§ãã‚‹</button>
                    </div>
                    
                    <input type="text" id="searchBox" class="search-box" placeholder="ğŸ” ãƒ¡ãƒ³ãƒãƒ¼æ¤œç´¢...">
                </div>
                
                <div class="filter-section">
                    <div class="filter-title">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div>
                    <div class="filter-group">
                        <button class="filter-btn active" id="filterAll">å…¨ã¦</button>
                        <button class="filter-btn" id="filterPending">æœªå®Ÿæ–½</button>
                        <button class="filter-btn" id="filterCompleted">å®Œäº†æ¸ˆã¿</button>
                        <button class="filter-btn" id="filterScheduled">äºˆå®šæ¸ˆã¿</button>
                    </div>
                </div>
                
                <div class="management-section">
                    <div class="filter-title">ğŸ‘¥ ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†</div>
                    
                    <button class="management-btn" id="showAddBtn">â• æ–°è¦è¿½åŠ </button>
                    <button class="management-btn" id="showFileBtn">ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«å–è¾¼</button>
                    <button class="management-btn delete" id="showDeleteBtn">ğŸ—‘ï¸ ãƒ¡ãƒ³ãƒãƒ¼å‰Šé™¤</button>
                    <button class="management-btn delete" id="showBulkDeleteBtn">â˜‘ï¸ è¤‡æ•°é¸æŠå‰Šé™¤</button>
                    
                    <!-- æ–°è¦è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  -->
                    <div class="add-form" id="addForm">
                        <input type="text" id="newId" class="form-input-small" placeholder="ID (ä¾‹: A100)">
                        <input type="text" id="newName" class="form-input-small" placeholder="åå‰">
                        <input type="text" id="newYomigana" class="form-input-small" placeholder="ã‚ˆã¿ãŒãª">
                        <input type="text" id="newCategory" class="form-input-small" placeholder="ã‚«ãƒ†ã‚´ãƒªãƒ¼">
                        <input type="text" id="newRole" class="form-input-small" placeholder="å½¹è·" value="ãƒ¡ãƒ³ãƒãƒ¼">
                        <div class="form-buttons">
                            <button class="btn-save" id="saveNewMember">è¿½åŠ </button>
                            <button class="btn-cancel" id="cancelAdd">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                        </div>
                    </div>
                    
                    <!-- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
                    <div class="file-upload" id="fileUpload">
                        <div class="file-area" id="fileArea">
                            <input type="file" id="fileInput" accept=".xlsx,.csv" style="display: none;">
                            ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ<br>
                            <small>Excel/CSVå¯¾å¿œ</small>
                        </div>
                        <div id="fileStatus"></div>
                        <button class="btn-cancel" id="cancelFile">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    </div>
                    
                    <!-- å‰Šé™¤ãƒ•ã‚©ãƒ¼ãƒ  -->
                    <div class="delete-form" id="deleteForm">
                        <div class="delete-warning">âš ï¸ å‰Šé™¤ãƒ¢ãƒ¼ãƒ‰ãŒæœ‰åŠ¹ã§ã™</div>
                        <p style="font-size: 13px; margin-bottom: 10px;">å‰Šé™¤ã—ãŸã„ãƒ¡ãƒ³ãƒãƒ¼ã®ğŸ—‘ï¸ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚<br>å‰Šé™¤ã™ã‚‹ã¨1to1ãƒ‡ãƒ¼ã‚¿ã‚‚ä¸€ç·’ã«å‰Šé™¤ã•ã‚Œã¾ã™ã€‚</p>
                        <button class="btn-cancel" id="cancelDelete">å‰Šé™¤ãƒ¢ãƒ¼ãƒ‰çµ‚äº†</button>
                    </div>
                    
                    <!-- è¤‡æ•°é¸æŠå‰Šé™¤ãƒ•ã‚©ãƒ¼ãƒ  -->
                    <div class="delete-form" id="bulkDeleteForm">
                        <div class="delete-warning">â˜‘ï¸ è¤‡æ•°é¸æŠå‰Šé™¤ãƒ¢ãƒ¼ãƒ‰ã§ã™</div>
                        <p style="font-size: 13px; margin-bottom: 10px;">å‰Šé™¤ã—ãŸã„ãƒ¡ãƒ³ãƒãƒ¼ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚</p>
                        <div style="margin: 10px 0;">
                            <button class="btn-save" id="selectAllBtn" style="background: #17a2b8; margin-right: 5px;">å…¨é¸æŠ</button>
                            <button class="btn-save" id="deselectAllBtn" style="background: #6c757d;">å…¨è§£é™¤</button>
                        </div>
                        <div style="margin: 10px 0;">
                            <span id="selectedCount">0</span>ä»¶é¸æŠä¸­
                        </div>
                        <div class="form-buttons">
                            <button class="btn-save" id="executeDelete" style="background: #dc3545;">é¸æŠã—ãŸãƒ¡ãƒ³ãƒãƒ¼ã‚’å‰Šé™¤</button>
                            <button class="btn-cancel" id="cancelBulkDelete">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                        </div>
                    </div>
                </div>
                
                <div class="member-list" id="memberList">
                    <!-- ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆãŒã“ã“ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
                    <div class="empty-state" id="emptyState">
                        <h3>ğŸ‘‹ ã‚ˆã†ã“ãï¼</h3>
                        <p>ã¾ã ãƒ¡ãƒ³ãƒãƒ¼ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚<br>
                        ã€Œâ• æ–°è¦è¿½åŠ ã€ã¾ãŸã¯ã€ŒğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«å–è¾¼ã€ã§<br>
                        ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</p>
                        <button class="empty-state-btn" onclick="document.getElementById('showAddBtn').click()">
                            æœ€åˆã®ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ 
                        </button>
                    </div>
                </div>
            </div>

            <div class="detail-panel">
                <div class="welcome-message" id="welcomeMessage">
                    ğŸ‘ˆ å·¦ã®ãƒªã‚¹ãƒˆã‹ã‚‰ãƒ¡ãƒ³ãƒãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„
                </div>
                
                <div class="member-detail" id="memberDetail">
                    <div class="detail-header">
                        <button class="back-btn" id="backToList" title="ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆã«æˆ»ã‚‹">
                            â† æˆ»ã‚‹
                        </button>
                        <button class="delete-current-member-btn" id="deleteCurrentMember" title="ã“ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚’å‰Šé™¤">
                            ğŸ—‘ï¸ å‰Šé™¤
                        </button>
                        <div class="detail-name" id="detailName"></div>
                        <div class="detail-category" id="detailCategory"></div>
                    </div>
                    
                    <div class="form-section">
                        <div class="form-title">ğŸ“… 1to1åŸºæœ¬æƒ…å ±</div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">å®Ÿæ–½æ—¥</label>
                                <input type="date" class="form-input" id="meetingDate">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
                                <select class="form-select" id="statusSelect">
                                    <option value="pending">æœªå®Ÿæ–½</option>
                                    <option value="scheduled">äºˆå®šæ¸ˆã¿</option>
                                    <option value="completed">å®Œäº†æ¸ˆã¿</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">å ´æ‰€ãƒ»æ–¹æ³•</label>
                            <div class="quick-buttons">
                                <button class="quick-btn" onclick="setLocation('ã‚ªãƒ•ã‚£ã‚¹')">ã‚ªãƒ•ã‚£ã‚¹</button>
                                <button class="quick-btn" onclick="setLocation('ã‚«ãƒ•ã‚§')">ã‚«ãƒ•ã‚§</button>
                                <button class="quick-btn" onclick="setLocation('ã‚ªãƒ³ãƒ©ã‚¤ãƒ³')">ã‚ªãƒ³ãƒ©ã‚¤ãƒ³</button>
                                <button class="quick-btn" onclick="setLocation('é›»è©±')">é›»è©±</button>
                            </div>
                            <input type="text" class="form-input" id="location" placeholder="å®Ÿæ–½å ´æ‰€ãƒ»æ–¹æ³•">
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <div class="form-title">ğŸ’¼ ãƒ“ã‚¸ãƒã‚¹æƒ…å ±</div>
                        
                        <div class="form-group">
                            <label class="form-label">è©³ã—ã„äº‹æ¥­å†…å®¹</label>
                            <textarea class="form-textarea" id="businessDetail" placeholder="ã‚ˆã‚Šè©³ã—ã„äº‹æ¥­å†…å®¹ã€ç‰¹å¾´ã€å¼·ã¿ãªã©"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ğŸ¯ ç†æƒ³çš„ãªç´¹ä»‹å…ˆï¼ˆã“ã®ãƒ¡ãƒ³ãƒãƒ¼ãŒæ±‚ã‚ã¦ã„ã‚‹äººï¼‰</label>
                            <textarea class="form-textarea" id="idealClient" placeholder="ã©ã‚“ãªæ–¹ã‚’ç´¹ä»‹ã—ã¦ã»ã—ã„ã‹ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆé¡§å®¢ãªã©"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ğŸ¤ ã‚ãªãŸãŒã§ãã‚‹ç´¹ä»‹ï¼ˆã“ã®ãƒ¡ãƒ³ãƒãƒ¼ã«ç´¹ä»‹ã§ããã†ãªäººãƒ»æ¡ˆä»¶ï¼‰</label>
                            <textarea class="form-textarea" id="canIntroduce" placeholder="ã“ã®ãƒ¡ãƒ³ãƒãƒ¼ã«ç´¹ä»‹ã§ããã†ãªäººãƒ»æ¡ˆä»¶"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <div class="form-title">ğŸ¯ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ»ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—</div>
                        
                        <div class="form-group">
                            <label class="form-label">ç´„æŸã—ãŸã“ã¨ãƒ»æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</label>
                            <textarea class="form-textarea" id="nextActions" placeholder="ç´„æŸã—ãŸã“ã¨ã€æ¬¡å›ã¾ã§ã«ã‚„ã‚‹ã“ã¨ã€ç´¹ä»‹äºˆå®šãªã©"></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">æ¬¡å›ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—æ—¥</label>
                                <input type="date" class="form-input" id="followupDate">
                            </div>
                            <div class="form-group">
                                <label class="form-label">å„ªå…ˆåº¦</label>
                                <select class="form-select" id="priority">
                                    <option value="normal">é€šå¸¸</option>
                                    <option value="high">é«˜</option>
                                    <option value="urgent">ç·Šæ€¥</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <div class="form-title">ğŸ“ ãã®ä»–ãƒ¡ãƒ¢</div>
                        
                        <div class="form-group">
                            <label class="form-label">è‡ªç”±ãƒ¡ãƒ¢</label>
                            <textarea class="form-textarea" id="freeNote" placeholder="å°è±¡ã€å€‹äººçš„ãªæƒ…å ±ã€è¦šãˆã¦ãŠããŸã„ã“ã¨ãªã©"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-section" id="matchingSection">
                        <div class="form-title">ğŸ’¡ ãƒãƒƒãƒãƒ³ã‚°å€™è£œ</div>
                        <div id="matchingResults">
                            <div class="matching-placeholder">
                                ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã™ã‚‹ã¨ãƒãƒƒãƒãƒ³ã‚°å€™è£œãŒè¡¨ç¤ºã•ã‚Œã¾ã™
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <div class="form-title">ğŸ“· æ·»ä»˜ç”»åƒï¼ˆæœ€å¤§2æšï¼‰</div>
                        
                        <div class="image-upload-area">
                            <div class="image-slot" id="imageSlot1">
                                <div class="image-placeholder" onclick="selectImage(1)">
                                    <div class="upload-icon">ğŸ“·</div>
                                    <p>ç”»åƒ1ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰<br><small>ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ</small></p>
                                </div>
                                <img class="uploaded-image" id="image1Preview" style="display: none;" onclick="viewImage(1)">
                                <div class="image-controls" id="image1Controls" style="display: none;">
                                    <button class="image-btn delete-image-btn" onclick="removeImage(1)">ğŸ—‘ï¸ å‰Šé™¤</button>
                                    <button class="image-btn view-image-btn" onclick="viewImage(1)">ğŸ” æ‹¡å¤§</button>
                                </div>
                            </div>
                            
                            <div class="image-slot" id="imageSlot2">
                                <div class="image-placeholder" onclick="selectImage(2)">
                                    <div class="upload-icon">ğŸ“·</div>
                                    <p>ç”»åƒ2ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰<br><small>ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ</small></p>
                                </div>
                                <img class="uploaded-image" id="image2Preview" style="display: none;" onclick="viewImage(2)">
                                <div class="image-controls" id="image2Controls" style="display: none;">
                                    <button class="image-btn delete-image-btn" onclick="removeImage(2)">ğŸ—‘ï¸ å‰Šé™¤</button>
                                    <button class="image-btn view-image-btn" onclick="viewImage(2)">ğŸ” æ‹¡å¤§</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="image-info">
                            <small>ğŸ’¡ å¯¾å¿œå½¢å¼: JPG, PNG, GIF, PDFï¼ˆæœ€å¤§5MB/æšï¼‰<br>
                            Zoomã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã€è³‡æ–™ã®PDFãªã©è‡ªç”±ã«æ·»ä»˜ã§ãã¾ã™</small>
                        </div>
                        
                        <!-- éš ã—ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ› -->
                        <input type="file" id="imageInput1" accept="image/*,.pdf" style="display: none;" onchange="handleImageUpload(1, event)">
                        <input type="file" id="imageInput2" accept="image/*,.pdf" style="display: none;" onchange="handleImageUpload(2, event)">
                    </div>
                    
                    <button class="save-btn" id="saveBtn">ğŸ’¾ ä¿å­˜ã™ã‚‹</button>
                </div>
                
                <div class="export-section">
                    <h3>ğŸ“Š ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h3>
                    <p>1to1ã®è¨˜éŒ²ã¨ãƒ¡ãƒ³ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†</p>
                    
                    <div style="margin-bottom: 15px;">
                        <h4 style="margin-bottom: 10px;">ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»åŒæœŸ</h4>
                        <button class="export-btn" id="exportAllData">ğŸ“¦ å…¨ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›</button>
                        <button class="export-btn" id="importAllData">ğŸ“¥ å…¨ãƒ‡ãƒ¼ã‚¿å–è¾¼</button>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <h4 style="margin-bottom: 10px;">ğŸ“ˆ ãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›</h4>
                        <button class="export-btn" id="exportExcel">ğŸ“ˆ Excelå‡ºåŠ›</button>
                        <button class="export-btn" id="exportSchedule">ğŸ“… äºˆå®šãƒªã‚¹ãƒˆå‡ºåŠ›</button>
                    </div>
                    
                    <div class="sync-info" style="background: #fff3cd; padding: 10px; border-radius: 8px; border-left: 4px solid #ffc107; margin-top: 15px;">
                        <small><strong>ğŸ’¡ è¤‡æ•°PCä½¿ç”¨æ™‚ã®ã‚³ãƒ„:</strong><br>
                        1. ä½œæ¥­çµ‚äº†æ™‚ã«ã€ŒğŸ“¦ å…¨ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›ã€ã§ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—<br>
                        2. ä»–ã®PCã§ã€ŒğŸ“¥ å…¨ãƒ‡ãƒ¼ã‚¿å–è¾¼ã€ã§åŒæœŸ<br>
                        3. å®šæœŸçš„ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä¿å­˜ã—ã¦ãŠãã¨å®‰å¿ƒ</small>
                    </div>
                    
                    <!-- ãƒ‡ãƒ¼ã‚¿å–è¾¼ç”¨ã®éš ã—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ -->
                    <input type="file" id="dataImportInput" accept=".json" style="display: none;">
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // ãƒ¡ãƒ³ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆç©ºã®é…åˆ—ã«å¤‰æ›´ï¼‰
        let members = [];

        let memberData = {};
        let currentMember = null;
        let currentSearchType = 'basic';
        let deleteMode = false;
        let bulkDeleteMode = false;
        let selectedMembers = new Set();

        // åˆæœŸåŒ–
        function init() {
            console.log('åˆæœŸåŒ–é–‹å§‹');
            loadFromStorage();
            setupEventListeners();
            renderMemberList();
            updateStats();
            console.log('åˆæœŸåŒ–å®Œäº†');
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        function setupEventListeners() {
            console.log('ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šé–‹å§‹');

            // æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹
            document.getElementById('searchBox').addEventListener('input', filterMembers);

            // æ¤œç´¢ã‚¿ãƒ–
            document.getElementById('basicSearch').addEventListener('click', () => setSearchType('basic'));
            document.getElementById('wantsSearch').addEventListener('click', () => setSearchType('wants'));
            document.getElementById('offersSearch').addEventListener('click', () => setSearchType('offers'));

            // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒœã‚¿ãƒ³
            document.getElementById('filterAll').addEventListener('click', () => setFilter('all'));
            document.getElementById('filterPending').addEventListener('click', () => setFilter('pending'));
            document.getElementById('filterCompleted').addEventListener('click', () => setFilter('completed'));
            document.getElementById('filterScheduled').addEventListener('click', () => setFilter('scheduled'));

            // ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†ãƒœã‚¿ãƒ³
            document.getElementById('showAddBtn').addEventListener('click', showAddForm);
            document.getElementById('showFileBtn').addEventListener('click', showFileUpload);
            document.getElementById('showDeleteBtn').addEventListener('click', showDeleteMode);
            document.getElementById('showBulkDeleteBtn').addEventListener('click', showBulkDeleteMode);
            document.getElementById('saveNewMember').addEventListener('click', addNewMember);
            document.getElementById('cancelAdd').addEventListener('click', hideAddForm);
            document.getElementById('cancelFile').addEventListener('click', hideFileUpload);
            document.getElementById('cancelDelete').addEventListener('click', hideDeleteMode);
            document.getElementById('cancelBulkDelete').addEventListener('click', hideBulkDeleteMode);
            document.getElementById('selectAllBtn').addEventListener('click', selectAllMembers);
            document.getElementById('deselectAllBtn').addEventListener('click', deselectAllMembers);
            document.getElementById('executeDelete').addEventListener('click', executeBulkDelete);

            // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
            document.getElementById('fileArea').addEventListener('click', () => {
                document.getElementById('fileInput').click();
            });
            document.getElementById('fileInput').addEventListener('change', handleFileUpload);

            // ä¿å­˜ãƒœã‚¿ãƒ³
            document.getElementById('saveBtn').addEventListener('click', saveMemberData);

            // æˆ»ã‚‹ãƒœã‚¿ãƒ³
            document.getElementById('backToList').addEventListener('click', backToMemberList);

            // ç¾åœ¨ã®ãƒ¡ãƒ³ãƒãƒ¼å‰Šé™¤ãƒœã‚¿ãƒ³
            document.getElementById('deleteCurrentMember').addEventListener('click', deleteCurrentMember);

            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´
            document.getElementById('statusSelect').addEventListener('change', saveMemberData);

            // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³
            document.getElementById('exportExcel').addEventListener('click', exportToExcel);
            document.getElementById('exportSchedule').addEventListener('click', exportSchedule);
            document.getElementById('exportAllData').addEventListener('click', exportAllData);
            document.getElementById('importAllData').addEventListener('click', () => {
                document.getElementById('dataImportInput').click();
            });
            document.getElementById('dataImportInput').addEventListener('change', importAllData);

            // ãƒ•ã‚©ãƒ¼ãƒ ã®å¤‰æ›´ã‚’ç›£è¦–ã—ã¦ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒƒãƒãƒ³ã‚°
            document.getElementById('businessDetail').addEventListener('input', updateMatching);
            document.getElementById('idealClient').addEventListener('input', updateMatching);
            document.getElementById('canIntroduce').addEventListener('input', updateMatching);

            console.log('ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šå®Œäº†');
        }

        // å‰Šé™¤ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤º
        function showDeleteMode() {
            deleteMode = true;
            bulkDeleteMode = false;
            hideAllForms();
            document.getElementById('deleteForm').classList.add('show');
            document.getElementById('memberList').classList.add('delete-mode');
            document.getElementById('memberList').classList.remove('bulk-delete-mode');
            renderMemberList();
        }

        // å‰Šé™¤ãƒ¢ãƒ¼ãƒ‰éè¡¨ç¤º
        function hideDeleteMode() {
            deleteMode = false;
            document.getElementById('deleteForm').classList.remove('show');
            document.getElementById('memberList').classList.remove('delete-mode');
            renderMemberList();
        }

        // è¤‡æ•°é¸æŠå‰Šé™¤ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤º
        function showBulkDeleteMode() {
            bulkDeleteMode = true;
            deleteMode = false;
            selectedMembers.clear();
            hideAllForms();
            document.getElementById('bulkDeleteForm').classList.add('show');
            document.getElementById('memberList').classList.add('bulk-delete-mode');
            document.getElementById('memberList').classList.remove('delete-mode');
            renderMemberList();
            updateSelectedCount();
        }

        // è¤‡æ•°é¸æŠå‰Šé™¤ãƒ¢ãƒ¼ãƒ‰éè¡¨ç¤º
        function hideBulkDeleteMode() {
            bulkDeleteMode = false;
            selectedMembers.clear();
            document.getElementById('bulkDeleteForm').classList.remove('show');
            document.getElementById('memberList').classList.remove('bulk-delete-mode');
            renderMemberList();
        }

        // å…¨é¸æŠ
        function selectAllMembers() {
            const visibleMembers = getVisibleMembers();
            visibleMembers.forEach(member => selectedMembers.add(member.id));
            renderMemberList();
            updateSelectedCount();
        }

        // å…¨è§£é™¤
        function deselectAllMembers() {
            selectedMembers.clear();
            renderMemberList();
            updateSelectedCount();
        }

        // é¸æŠæ•°æ›´æ–°
        function updateSelectedCount() {
            document.getElementById('selectedCount').textContent = selectedMembers.size;
        }

        // è¡¨ç¤ºä¸­ã®ãƒ¡ãƒ³ãƒãƒ¼å–å¾—
        function getVisibleMembers() {
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            const activeFilter = document.querySelector('.filter-btn.active').id.replace('filter', '').toLowerCase();
            
            return members.filter(member => {
                // ãƒ†ã‚­ã‚¹ãƒˆæ¤œç´¢
                let matchesSearch = true;
                if (searchTerm) {
                    if (currentSearchType === 'basic') {
                        matchesSearch = member.name.toLowerCase().includes(searchTerm) ||
                                      member.yomigana.toLowerCase().includes(searchTerm) ||
                                      member.category.toLowerCase().includes(searchTerm) ||
                                      member.id.toLowerCase().includes(searchTerm);
                    } else if (currentSearchType === 'wants') {
                        const data = memberData[member.id];
                        matchesSearch = data && data.idealClient && data.idealClient.toLowerCase().includes(searchTerm);
                    } else if (currentSearchType === 'offers') {
                        const data = memberData[member.id];
                        matchesSearch = data && data.canIntroduce && data.canIntroduce.toLowerCase().includes(searchTerm);
                    }
                }
                
                // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                let matchesFilter = true;
                if (activeFilter !== 'all') {
                    const status = getMemberStatus(member.id);
                    matchesFilter = status === activeFilter;
                }
                
                return matchesSearch && matchesFilter;
            });
        }

        // ä¸€æ‹¬å‰Šé™¤å®Ÿè¡Œ
        function executeBulkDelete() {
            if (selectedMembers.size === 0) {
                alert('å‰Šé™¤ã™ã‚‹ãƒ¡ãƒ³ãƒãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            const selectedMemberNames = Array.from(selectedMembers).map(id => 
                members.find(m => m.id === id)?.name || id
            ).join('ã€');

            if (!confirm(`ä»¥ä¸‹ã®${selectedMembers.size}äººã®ãƒ¡ãƒ³ãƒãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\n${selectedMemberNames}\n\nãƒ»ãƒ¡ãƒ³ãƒãƒ¼æƒ…å ±\nãƒ»1to1ã®è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿\nãƒ»æ·»ä»˜ç”»åƒ\n\nã™ã¹ã¦ãŒå®Œå…¨ã«å‰Šé™¤ã•ã‚Œã¾ã™ã€‚`)) {
                return;
            }

            // é¸æŠã•ã‚ŒãŸãƒ¡ãƒ³ãƒãƒ¼ã‚’å‰Šé™¤
            const deletedCount = selectedMembers.size;
            members = members.filter(m => !selectedMembers.has(m.id));
            
            // 1to1ãƒ‡ãƒ¼ã‚¿ã‚‚å‰Šé™¤
            selectedMembers.forEach(id => {
                delete memberData[id];
            });

            // ç¾åœ¨é¸æŠä¸­ã®ãƒ¡ãƒ³ãƒãƒ¼ãŒå‰Šé™¤å¯¾è±¡ãªã‚‰è©³ç´°ç”»é¢ã‚’ã‚¯ãƒªã‚¢
            if (currentMember && selectedMembers.has(currentMember.id)) {
                backToMemberList();
            }

            // ä¿å­˜ã¨ç”»é¢æ›´æ–°
            saveToStorage();
            hideBulkDeleteMode();
            renderMemberList();
            updateStats();
            
            alert(`${deletedCount}äººã®ãƒ¡ãƒ³ãƒãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚`);
        }

        // ãƒ¡ãƒ³ãƒãƒ¼ã®é¸æŠçŠ¶æ…‹ã‚’åˆ‡ã‚Šæ›¿ãˆ
        function toggleMemberSelection(memberId) {
            if (selectedMembers.has(memberId)) {
                selectedMembers.delete(memberId);
            } else {
                selectedMembers.add(memberId);
            }
            updateSelectedCount();
        }

        // ãƒ¡ãƒ³ãƒãƒ¼å‰Šé™¤ï¼ˆãƒªã‚¹ãƒˆã‹ã‚‰ï¼‰
        function deleteMember(event, memberId) {
            event.stopPropagation();
            
            const member = members.find(m => m.id === memberId);
            if (!member) return;
            
            if (!confirm(`${member.name}ã•ã‚“ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\nãƒ»ãƒ¡ãƒ³ãƒãƒ¼æƒ…å ±\nãƒ»1to1ã®è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿\nãƒ»æ·»ä»˜ç”»åƒ\n\nã™ã¹ã¦ãŒå®Œå…¨ã«å‰Šé™¤ã•ã‚Œã¾ã™ã€‚`)) {
                return;
            }
            
            // ãƒ¡ãƒ³ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å‰Šé™¤
            members = members.filter(m => m.id !== memberId);
            
            // 1to1ãƒ‡ãƒ¼ã‚¿ã‚‚å‰Šé™¤
            delete memberData[memberId];
            
            // ç¾åœ¨é¸æŠä¸­ã®ãƒ¡ãƒ³ãƒãƒ¼ãªã‚‰è©³ç´°ç”»é¢ã‚’ã‚¯ãƒªã‚¢
            if (currentMember && currentMember.id === memberId) {
                backToMemberList();
            }
            
            // ä¿å­˜ã¨ç”»é¢æ›´æ–°
            saveToStorage();
            renderMemberList();
            updateStats();
            
            alert(`${member.name}ã•ã‚“ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚`);
        }

        // ç¾åœ¨ã®ãƒ¡ãƒ³ãƒãƒ¼å‰Šé™¤
        function deleteCurrentMember() {
            if (!currentMember) return;
            
            if (!confirm(`${currentMember.name}ã•ã‚“ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\nãƒ»ãƒ¡ãƒ³ãƒãƒ¼æƒ…å ±\nãƒ»1to1ã®è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿\nãƒ»æ·»ä»˜ç”»åƒ\n\nã™ã¹ã¦ãŒå®Œå…¨ã«å‰Šé™¤ã•ã‚Œã¾ã™ã€‚`)) {
                return;
            }
            
            // ãƒ¡ãƒ³ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å‰Šé™¤
            members = members.filter(m => m.id !== currentMember.id);
            
            // 1to1ãƒ‡ãƒ¼ã‚¿ã‚‚å‰Šé™¤
            delete memberData[currentMember.id];
            
            // è©³ç´°ç”»é¢ã‚’ã‚¯ãƒªã‚¢
            backToMemberList();
            
            // ä¿å­˜ã¨ç”»é¢æ›´æ–°
            saveToStorage();
            renderMemberList();
            updateStats();
            
            alert(`${currentMember.name}ã•ã‚“ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚`);
        }

        // æ¤œç´¢ã‚¿ã‚¤ãƒ—è¨­å®š
        function setSearchType(type) {
            currentSearchType = type;
            document.querySelectorAll('.search-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(type + 'Search').classList.add('active');
            
            const placeholder = {
                'basic': 'ğŸ” ãƒ¡ãƒ³ãƒãƒ¼æ¤œç´¢...',
                'wants': 'ğŸ¯ ç´¹ä»‹ã—ã¦ã»ã—ã„äººãƒ»æ¥­ç¨®ã§æ¤œç´¢...',
                'offers': 'ğŸ¤ ç´¹ä»‹ã§ãã‚‹äººãƒ»æ¥­ç¨®ã§æ¤œç´¢...'
            };
            document.getElementById('searchBox').placeholder = placeholder[type];
            filterMembers();
        }

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¨­å®š
        function setFilter(filter) {
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('filter' + filter.charAt(0).toUpperCase() + filter.slice(1)).classList.add('active');
            filterMembers();
        }

        // ãƒ¡ãƒ³ãƒãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        function filterMembers() {
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            const activeFilter = document.querySelector('.filter-btn.active').id.replace('filter', '').toLowerCase();
            
            let filtered = members.filter(member => {
                // ãƒ†ã‚­ã‚¹ãƒˆæ¤œç´¢
                let matchesSearch = true;
                if (searchTerm) {
                    if (currentSearchType === 'basic') {
                        matchesSearch = member.name.toLowerCase().includes(searchTerm) ||
                                      member.yomigana.toLowerCase().includes(searchTerm) ||
                                      member.category.toLowerCase().includes(searchTerm) ||
                                      member.id.toLowerCase().includes(searchTerm);
                    } else if (currentSearchType === 'wants') {
                        const data = memberData[member.id];
                        matchesSearch = data && data.idealClient && data.idealClient.toLowerCase().includes(searchTerm);
                    } else if (currentSearchType === 'offers') {
                        const data = memberData[member.id];
                        matchesSearch = data && data.canIntroduce && data.canIntroduce.toLowerCase().includes(searchTerm);
                    }
                }
                
                // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                let matchesFilter = true;
                if (activeFilter !== 'all') {
                    const status = getMemberStatus(member.id);
                    matchesFilter = status === activeFilter;
                }
                
                return matchesSearch && matchesFilter;
            });
            
            renderMemberList(filtered);
        }

        // ãƒ¡ãƒ³ãƒãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å–å¾—
        function getMemberStatus(memberId) {
            const data = memberData[memberId];
            return data ? (data.status || 'pending') : 'pending';
        }

        // ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆè¡¨ç¤º
        function renderMemberList(filteredMembers = members) {
            const listContainer = document.getElementById('memberList');
            const emptyState = document.getElementById('emptyState');
            
            if (members.length === 0) {
                // ãƒ¡ãƒ³ãƒãƒ¼ãŒä¸€äººã‚‚ã„ãªã„å ´åˆã¯ç©ºã®çŠ¶æ…‹ã‚’è¡¨ç¤º
                listContainer.innerHTML = '';
                listContainer.appendChild(emptyState);
                return;
            }
            
            // ç©ºã®çŠ¶æ…‹ã‚’éè¡¨ç¤ºã«ã—ã¦é€šå¸¸ã®ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
            if (emptyState.parentNode) {
                emptyState.style.display = 'none';
            }
            
            listContainer.innerHTML = '';

            const actualFilteredMembers = filteredMembers.length === members.length ? getVisibleMembers() : filteredMembers;

            actualFilteredMembers.forEach(member => {
                const status = getMemberStatus(member.id);
                const div = document.createElement('div');
                div.className = `member-item ${status === 'completed' ? 'completed' : ''}`;
                
                if (!bulkDeleteMode) {
                    div.onclick = () => selectMember(member);
                }
                
                const isSelected = selectedMembers.has(member.id);
                
                div.innerHTML = `
                    <input type="checkbox" class="member-checkbox" ${isSelected ? 'checked' : ''} 
                           onchange="toggleMemberSelection('${member.id}'); event.stopPropagation();">
                    <div class="member-info">
                        <div class="member-name">${member.name}</div>
                        <div class="member-category">${member.category}</div>
                        <div class="member-id">${member.id} - ${member.role}</div>
                    </div>
                    <div class="member-actions">
                        <div class="status-indicator ${status}"></div>
                        <button class="delete-member-btn" onclick="deleteMember(event, '${member.id}')" title="ãƒ¡ãƒ³ãƒãƒ¼ã‚’å‰Šé™¤">ğŸ—‘ï¸</button>
                    </div>
                `;
                
                listContainer.appendChild(div);
            });
        }

        // ãƒ¡ãƒ³ãƒãƒ¼é¸æŠ
        function selectMember(member) {
            currentMember = member;
            
            // é¸æŠçŠ¶æ…‹æ›´æ–°
            document.querySelectorAll('.member-item').forEach(item => item.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            
            // è©³ç´°ãƒ‘ãƒãƒ«è¡¨ç¤º
            document.getElementById('welcomeMessage').style.display = 'none';
            document.getElementById('memberDetail').classList.add('active');
            
            // ãƒ¡ãƒ³ãƒãƒ¼æƒ…å ±è¡¨ç¤º
            document.getElementById('detailName').textContent = member.name;
            document.getElementById('detailCategory').textContent = `${member.id} - ${member.category}`;
            
            // ä¿å­˜ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
            loadMemberData(member.id);
            
            // ãƒãƒƒãƒãƒ³ã‚°æ›´æ–°
            updateMatching();
        }

        // ãƒ¡ãƒ³ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        function loadMemberData(memberId) {
            const data = memberData[memberId] || {};
            
            document.getElementById('meetingDate').value = data.meetingDate || '';
            document.getElementById('statusSelect').value = data.status || 'pending';
            document.getElementById('location').value = data.location || '';
            document.getElementById('businessDetail').value = data.businessDetail || '';
            document.getElementById('idealClient').value = data.idealClient || '';
            document.getElementById('canIntroduce').value = data.canIntroduce || '';
            document.getElementById('nextActions').value = data.nextActions || '';
            document.getElementById('followupDate').value = data.followupDate || '';
            document.getElementById('priority').value = data.priority || 'normal';
            document.getElementById('freeNote').value = data.freeNote || '';
            
            // ç”»åƒãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
            loadImages(data.images || {});
        }

        // ãƒãƒƒãƒãƒ³ã‚°æ›´æ–°
        function updateMatching() {
            if (!currentMember) return;

            const currentData = {
                businessDetail: document.getElementById('businessDetail').value,
                idealClient: document.getElementById('idealClient').value,
                canIntroduce: document.getElementById('canIntroduce').value
            };

            const matches = findMatches(currentMember.id, currentData);
            renderMatching(matches);
        }

        // ãƒãƒƒãƒãƒ³ã‚°æ¤œç´¢
        function findMatches(currentMemberId, currentData) {
            const matches = [];

            members.forEach(member => {
                if (member.id === currentMemberId) return; // è‡ªåˆ†è‡ªèº«ã¯é™¤å¤–

                const memberData_local = memberData[member.id] || {};
                const matchReasons = [];
                let totalScore = 0;

                // 1. ç¾åœ¨ã®ãƒ¡ãƒ³ãƒãƒ¼ã®ã€Œç†æƒ³çš„ãªç´¹ä»‹å…ˆã€ã¨ä»–ãƒ¡ãƒ³ãƒãƒ¼ã®ã€Œäº‹æ¥­å†…å®¹ã€ã‚’ãƒãƒƒãƒãƒ³ã‚°
                if (currentData.idealClient && memberData_local.businessDetail) {
                    const score = calculateTextMatch(currentData.idealClient, memberData_local.businessDetail);
                    if (score > 0) {
                        matchReasons.push({
                            type: 'wants',
                            score: score,
                            text: `${currentMember.name}ãŒæ±‚ã‚ã‚‹äººæ â‡„ ${member.name}ã®äº‹æ¥­å†…å®¹`,
                            keywords: extractMatchingKeywords(currentData.idealClient, memberData_local.businessDetail)
                        });
                        totalScore += score;
                    }
                }

                // 2. ç¾åœ¨ã®ãƒ¡ãƒ³ãƒãƒ¼ã®ã€Œç´¹ä»‹ã§ãã‚‹ã“ã¨ã€ã¨ä»–ãƒ¡ãƒ³ãƒãƒ¼ã®ã€Œç†æƒ³çš„ãªç´¹ä»‹å…ˆã€ã‚’ãƒãƒƒãƒãƒ³ã‚°
                if (currentData.canIntroduce && memberData_local.idealClient) {
                    const score = calculateTextMatch(currentData.canIntroduce, memberData_local.idealClient);
                    if (score > 0) {
                        matchReasons.push({
                            type: 'offers',
                            score: score,
                            text: `${currentMember.name}ãŒç´¹ä»‹ã§ãã‚‹ â‡„ ${member.name}ãŒæ±‚ã‚ã‚‹äººæ`,
                            keywords: extractMatchingKeywords(currentData.canIntroduce, memberData_local.idealClient)
                        });
                        totalScore += score;
                    }
                }

                // 3. ç¾åœ¨ã®ãƒ¡ãƒ³ãƒãƒ¼ã®ã€Œäº‹æ¥­å†…å®¹ã€ã¨ä»–ãƒ¡ãƒ³ãƒãƒ¼ã®ã€Œç†æƒ³çš„ãªç´¹ä»‹å…ˆã€ã‚’ãƒãƒƒãƒãƒ³ã‚°
                if (currentData.businessDetail && memberData_local.idealClient) {
                    const score = calculateTextMatch(currentData.businessDetail, memberData_local.idealClient);
                    if (score > 0) {
                        matchReasons.push({
                            type: 'business',
                            score: score,
                            text: `${currentMember.name}ã®äº‹æ¥­å†…å®¹ â‡„ ${member.name}ãŒæ±‚ã‚ã‚‹äººæ`,
                            keywords: extractMatchingKeywords(currentData.businessDetail, memberData_local.idealClient)
                        });
                        totalScore += score;
                    }
                }

                if (matchReasons.length > 0) {
                    matches.push({
                        member: member,
                        reasons: matchReasons,
                        totalScore: totalScore,
                        level: totalScore >= 3 ? 'high' : totalScore >= 2 ? 'medium' : 'low'
                    });
                }
            });

            // ã‚¹ã‚³ã‚¢é †ã«ã‚½ãƒ¼ãƒˆ
            return matches.sort((a, b) => b.totalScore - a.totalScore);
        }

        // ãƒ†ã‚­ã‚¹ãƒˆãƒãƒƒãƒãƒ³ã‚°è¨ˆç®—
        function calculateTextMatch(text1, text2) {
            if (!text1 || !text2) return 0;

            const keywords1 = extractKeywords(text1);
            const keywords2 = extractKeywords(text2);
            
            let matchCount = 0;
            let totalKeywords = Math.max(keywords1.length, keywords2.length);

            keywords1.forEach(keyword => {
                if (keywords2.some(k => k.includes(keyword) || keyword.includes(k))) {
                    matchCount++;
                }
            });

            // ã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆ0-5ã®ç¯„å›²ï¼‰
            return Math.min(5, Math.round((matchCount / Math.max(1, totalKeywords * 0.3)) * 3));
        }

        // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡º
        function extractKeywords(text) {
            if (!text) return [];
            
            // ä¸€èˆ¬çš„ãªé™¤å¤–èª
            const stopWords = ['ã®', 'ã‚’', 'ã«', 'ã¯', 'ãŒ', 'ã§', 'ã¨', 'ã‚‚', 'ã‹ã‚‰', 'ã¾ã§', 'ã¨ã—ã¦', 'ã«ã¤ã„ã¦', 'ã«ã‚ˆã‚‹', 'ãªã©', 'ã¾ãŸã¯', 'ãŠã‚ˆã³', 'ã¾ãŸ', 'ã•ã‚‰ã«', 'ã—ã‹ã—', 'ãŸã ã—', 'ãŸã‚', 'ã“ã¨', 'ã‚‚ã®', 'ã‚ã‚‹', 'ã„ã‚‹', 'ã™ã‚‹', 'ã•ã‚Œã‚‹', 'ã§ãã‚‹', 'ã‚Œã‚‹', 'ã‚‰ã—ã„'];
            
            return text
                .replace(/[ã€ã€‚ï¼ï¼Ÿ\s\n\r]/g, ' ')
                .split(' ')
                .map(word => word.trim())
                .filter(word => word.length >= 2 && !stopWords.includes(word))
                .filter(word => /[ã-ã‚“ã‚¡-ãƒ¶ä¸€-é¾ a-zA-Z0-9]/.test(word));
        }

        // ãƒãƒƒãƒãƒ³ã‚°ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡º
        function extractMatchingKeywords(text1, text2) {
            const keywords1 = extractKeywords(text1);
            const keywords2 = extractKeywords(text2);
            const matching = [];

            keywords1.forEach(k1 => {
                keywords2.forEach(k2 => {
                    if (k1.includes(k2) || k2.includes(k1)) {
                        if (!matching.includes(k1)) matching.push(k1);
                        if (!matching.includes(k2)) matching.push(k2);
                    }
                });
            });

            return matching.slice(0, 5); // æœ€å¤§5å€‹
        }

        // ãƒãƒƒãƒãƒ³ã‚°çµæœè¡¨ç¤º
        function renderMatching(matches) {
            const container = document.getElementById('matchingResults');
            
            if (matches.length === 0) {
                container.innerHTML = '<div class="no-matches">ç¾åœ¨ã®ã¨ã“ã‚ãƒãƒƒãƒã™ã‚‹å€™è£œã¯ã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }

            const html = matches.map(match => {
                const scoreText = match.level === 'high' ? 'é«˜' : match.level === 'medium' ? 'ä¸­' : 'ä½';
                const reasonsHtml = match.reasons.map(reason => {
                    const keywordsHtml = reason.keywords.map(kw => 
                        `<span class="matching-keyword highlight">${kw}</span>`
                    ).join('');
                    
                    const typeIcon = reason.type === 'wants' ? 'ğŸ¯' : reason.type === 'offers' ? 'ğŸ¤' : 'ğŸ’¼';
                    
                    return `
                        <div class="matching-reason ${reason.type}">
                            ${typeIcon} ${reason.text}
                            <div class="matching-keywords">${keywordsHtml}</div>
                        </div>
                    `;
                }).join('');

                return `
                    <div class="matching-card ${match.level}-match" onclick="selectMemberById('${match.member.id}')">
                        <div class="matching-header">
                            <div class="matching-name">${match.member.name}</div>
                            <div class="matching-score ${match.level}">ãƒãƒƒãƒåº¦: ${scoreText}</div>
                        </div>
                        <div class="matching-category">${match.member.category}</div>
                        ${reasonsHtml}
                    </div>
                `;
            }).join('');

            container.innerHTML = `<div class="matching-results">${html}</div>`;
        }

        // IDã§ãƒ¡ãƒ³ãƒãƒ¼é¸æŠ
        function selectMemberById(memberId) {
            const member = members.find(m => m.id === memberId);
            if (member) {
                selectMember(member);
                // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆã®é¸æŠã‚’è¦‹ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹
                const memberElement = document.querySelector(`.member-item[onclick*="${memberId}"]`);
                if (memberElement) {
                    memberElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        }

        // ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆã«æˆ»ã‚‹
        function backToMemberList() {
            // ç¾åœ¨ã®é¸æŠã‚’ã‚¯ãƒªã‚¢
            currentMember = null;
            
            // å·¦å´ã®é¸æŠçŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢
            document.querySelectorAll('.member-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // å³å´ã‚’ã‚¦ã‚§ãƒ«ã‚«ãƒ ç”»é¢ã«æˆ»ã™
            document.getElementById('memberDetail').classList.remove('active');
            document.getElementById('welcomeMessage').style.display = 'block';
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
            resetMemberForm();
        }

        // ãƒ¡ãƒ³ãƒãƒ¼ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
        function resetMemberForm() {
            document.getElementById('meetingDate').value = '';
            document.getElementById('statusSelect').value = 'pending';
            document.getElementById('location').value = '';
            document.getElementById('businessDetail').value = '';
            document.getElementById('idealClient').value = '';
            document.getElementById('canIntroduce').value = '';
            document.getElementById('nextActions').value = '';
            document.getElementById('followupDate').value = '';
            document.getElementById('priority').value = 'normal';
            document.getElementById('freeNote').value = '';
            
            // ç”»åƒã‚‚ãƒªã‚»ãƒƒãƒˆ
            loadImages({});
        }

        // ç”»åƒãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        function loadImages(images) {
            for (let i = 1; i <= 2; i++) {
                const imageData = images[`image${i}`];
                const preview = document.getElementById(`image${i}Preview`);
                const placeholder = document.querySelector(`#imageSlot${i} .image-placeholder`);
                const controls = document.getElementById(`image${i}Controls`);
                
                if (imageData) {
                    preview.src = imageData;
                    preview.style.display = 'block';
                    placeholder.style.display = 'none';
                    controls.style.display = 'flex';
                } else {
                    preview.style.display = 'none';
                    placeholder.style.display = 'flex';
                    controls.style.display = 'none';
                }
            }
        }

        // ç”»åƒé¸æŠ
        function selectImage(slot) {
            document.getElementById(`imageInput${slot}`).click();
        }

        // ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
        function handleImageUpload(slot, event) {
            const file = event.target.files[0];
            if (!file) return;

            // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯ï¼ˆ5MBï¼‰
            if (file.size > 5 * 1024 * 1024) {
                alert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã¾ã™ã€‚5MBä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const imageData = e.target.result;
                
                // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
                const preview = document.getElementById(`image${slot}Preview`);
                const placeholder = document.querySelector(`#imageSlot${slot} .image-placeholder`);
                const controls = document.getElementById(`image${slot}Controls`);
                
                preview.src = imageData;
                preview.style.display = 'block';
                placeholder.style.display = 'none';
                controls.style.display = 'flex';
                
                // è‡ªå‹•ä¿å­˜
                if (currentMember) {
                    saveMemberData();
                }
            };
            
            reader.readAsDataURL(file);
        }

        // ç”»åƒå‰Šé™¤
        function removeImage(slot) {
            if (!confirm('ã“ã®ç”»åƒã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
            
            const preview = document.getElementById(`image${slot}Preview`);
            const placeholder = document.querySelector(`#imageSlot${slot} .image-placeholder`);
            const controls = document.getElementById(`image${slot}Controls`);
            const input = document.getElementById(`imageInput${slot}`);
            
            preview.style.display = 'none';
            placeholder.style.display = 'flex';
            controls.style.display = 'none';
            input.value = '';
            
            // è‡ªå‹•ä¿å­˜
            if (currentMember) {
                saveMemberData();
            }
        }

        // ç”»åƒæ‹¡å¤§è¡¨ç¤º
        function viewImage(slot) {
            const preview = document.getElementById(`image${slot}Preview`);
            if (!preview.src) return;
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ä½œæˆ
            const modal = document.createElement('div');
            modal.className = 'image-modal';
            modal.onclick = () => modal.remove();
            
            const img = document.createElement('img');
            img.src = preview.src;
            
            const closeBtn = document.createElement('div');
            closeBtn.className = 'close-modal';
            closeBtn.innerHTML = 'Ã—';
            closeBtn.onclick = () => modal.remove();
            
            modal.appendChild(img);
            modal.appendChild(closeBtn);
            document.body.appendChild(modal);
        }

        // ãƒ¡ãƒ³ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ä¿å­˜
        function saveMemberData() {
            if (!currentMember) return;
            
            // ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            const images = {};
            for (let i = 1; i <= 2; i++) {
                const preview = document.getElementById(`image${i}Preview`);
                if (preview.style.display === 'block' && preview.src) {
                    images[`image${i}`] = preview.src;
                }
            }
            
            const data = {
                meetingDate: document.getElementById('meetingDate').value,
                status: document.getElementById('statusSelect').value,
                location: document.getElementById('location').value,
                businessDetail: document.getElementById('businessDetail').value,
                idealClient: document.getElementById('idealClient').value,
                canIntroduce: document.getElementById('canIntroduce').value,
                nextActions: document.getElementById('nextActions').value,
                followupDate: document.getElementById('followupDate').value,
                priority: document.getElementById('priority').value,
                freeNote: document.getElementById('freeNote').value,
                images: images,
                lastUpdated: new Date().toISOString()
            };
            
            memberData[currentMember.id] = data;
            saveToStorage();
            updateStats();
            renderMemberList();
            
            // ä¿å­˜ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
            const saveBtn = document.getElementById('saveBtn');
            const originalText = saveBtn.textContent;
            saveBtn.textContent = 'âœ… ä¿å­˜å®Œäº†!';
            setTimeout(() => {
                saveBtn.textContent = originalText;
            }, 2000);
        }

        // å ´æ‰€è¨­å®š
        function setLocation(location) {
            document.getElementById('location').value = location;
        }

        // çµ±è¨ˆæ›´æ–°
        function updateStats() {
            const total = members.length;
            const completed = Object.values(memberData).filter(data => data.status === 'completed').length;
            const scheduled = Object.values(memberData).filter(data => data.status === 'scheduled').length;
            const progress = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            document.getElementById('totalMembers').textContent = total;
            document.getElementById('completedCount').textContent = completed;
            document.getElementById('scheduledCount').textContent = scheduled;
            document.getElementById('progressPercent').textContent = progress + '%';
            document.getElementById('progressBar').style.width = progress + '%';
        }

        // æ–°è¦è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤º
        function showAddForm() {
            hideAllForms();
            document.getElementById('addForm').classList.add('show');
        }

        // æ–°è¦è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ éè¡¨ç¤º
        function hideAddForm() {
            document.getElementById('addForm').classList.remove('show');
            clearAddForm();
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰è¡¨ç¤º
        function showFileUpload() {
            hideAllForms();
            document.getElementById('fileUpload').classList.add('show');
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰éè¡¨ç¤º
        function hideFileUpload() {
            document.getElementById('fileUpload').classList.remove('show');
            document.getElementById('fileInput').value = '';
            document.getElementById('fileStatus').innerHTML = '';
        }

        // å…¨ãƒ•ã‚©ãƒ¼ãƒ éè¡¨ç¤º
        function hideAllForms() {
            document.getElementById('addForm').classList.remove('show');
            document.getElementById('fileUpload').classList.remove('show');
            document.getElementById('deleteForm').classList.remove('show');
            document.getElementById('bulkDeleteForm').classList.remove('show');
            hideDeleteMode();
            hideBulkDeleteMode();
        }

        // æ–°è¦ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ 
        function addNewMember() {
            const id = document.getElementById('newId').value.trim();
            const name = document.getElementById('newName').value.trim();
            const yomigana = document.getElementById('newYomigana').value.trim();
            const category = document.getElementById('newCategory').value.trim();
            const role = document.getElementById('newRole').value.trim() || 'ãƒ¡ãƒ³ãƒãƒ¼';

            if (!id || !name || !yomigana || !category) {
                alert('IDã€åå‰ã€ã‚ˆã¿ãŒãªã€ã‚«ãƒ†ã‚´ãƒªãƒ¼ã¯å¿…é ˆã§ã™ã€‚');
                return;
            }

            if (members.find(m => m.id === id)) {
                alert('ã“ã®IDã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚');
                return;
            }

            members.push({ id, name, yomigana, category, role });
            saveToStorage();
            renderMemberList();
            updateStats();
            hideAddForm();
            alert('ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼');
        }

        // è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ ã‚¯ãƒªã‚¢
        function clearAddForm() {
            document.getElementById('newId').value = '';
            document.getElementById('newName').value = '';
            document.getElementById('newYomigana').value = '';
            document.getElementById('newCategory').value = '';
            document.getElementById('newRole').value = 'ãƒ¡ãƒ³ãƒãƒ¼';
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const fileStatus = document.getElementById('fileStatus');
            fileStatus.textContent = 'å‡¦ç†ä¸­...';

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    let data;
                    if (file.name.endsWith('.xlsx')) {
                        const workbook = XLSX.read(e.target.result, { type: 'array' });
                        const sheet = workbook.Sheets[workbook.SheetNames[0]];
                        data = XLSX.utils.sheet_to_json(sheet, { header: 1 });
                    } else if (file.name.endsWith('.csv')) {
                        const text = new TextDecoder().decode(new Uint8Array(e.target.result));
                        data = text.split('\n').map(row => {
                            const cells = [];
                            let currentCell = '';
                            let inQuotes = false;
                            
                            for (let i = 0; i < row.length; i++) {
                                const char = row[i];
                                if (char === '"') {
                                    inQuotes = !inQuotes;
                                } else if (char === ',' && !inQuotes) {
                                    cells.push(currentCell.trim().replace(/^"|"$/g, ''));
                                    currentCell = '';
                                } else {
                                    currentCell += char;
                                }
                            }
                            cells.push(currentCell.trim().replace(/^"|"$/g, ''));
                            return cells;
                        }).filter(row => row.some(cell => cell.length > 0));
                    }
                    
                    processImportData(data);
                } catch (error) {
                    fileStatus.textContent = 'ã‚¨ãƒ©ãƒ¼: ' + error.message;
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿å‡¦ç†
        function processImportData(data) {
            const fileStatus = document.getElementById('fileStatus');
            
            if (!data || data.length === 0) {
                fileStatus.textContent = 'ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“';
                return;
            }

            let added = 0;
            let skipped = 0;
            let errors = 0;
            
            const firstRow = data[0];
            let nameCol = -1, yomiganaCol = -1, categoryCol = -1, roleCol = -1, idCol = -1;
            
            if (firstRow) {
                for (let i = 0; i < firstRow.length; i++) {
                    const header = String(firstRow[i] || '').toLowerCase();
                    if (header.includes('åå‰') || header.includes('name')) nameCol = i;
                    else if (header.includes('ã‚ˆã¿ãŒãª') || header.includes('yomigana') || header.includes('èª­ã¿')) yomiganaCol = i;
                    else if (header.includes('ã‚«ãƒ†ã‚´ãƒªãƒ¼') || header.includes('category') || header.includes('æ¥­ç¨®')) categoryCol = i;
                    else if (header.includes('å½¹è·') || header.includes('role') || header.includes('è·')) roleCol = i;
                    else if (header.includes('id') || header === 'id') idCol = i;
                }
            }
            
            const hasHeader = nameCol >= 0 || yomiganaCol >= 0 || categoryCol >= 0;
            const startRow = hasHeader ? 1 : 0;
            
            if (nameCol === -1) nameCol = 0;
            if (yomiganaCol === -1) yomiganaCol = 2;
            if (categoryCol === -1) categoryCol = 3;
            if (roleCol === -1) roleCol = 6;
            
            for (let i = startRow; i < data.length; i++) {
                const row = data[i];
                
                if (!row || row.length === 0) continue;
                
                const name = String(row[nameCol] || '').trim();
                const yomigana = String(row[yomiganaCol] || '').trim();
                const category = String(row[categoryCol] || '').trim();
                const role = String(row[roleCol] || 'ãƒ¡ãƒ³ãƒãƒ¼').trim();
                
                let id;
                if (idCol >= 0 && row[idCol]) {
                    id = String(row[idCol]).trim();
                } else {
                    const firstChar = name ? name.charAt(0) : 'M';
                    id = `${firstChar}${i}`;
                }
                
                if (!name || !category) {
                    errors++;
                    continue;
                }
                
                if (members.find(m => m.name === name)) {
                    skipped++;
                    continue;
                }
                
                if (members.find(m => m.id === id)) {
                    let counter = 1;
                    let newId = `${id}_${counter}`;
                    while (members.find(m => m.id === newId)) {
                        counter++;
                        newId = `${id}_${counter}`;
                    }
                    id = newId;
                }
                
                const finalYomigana = yomigana || `${name.replace(/\s+/g, '')} dummy`;
                
                const newMember = { id, name, yomigana: finalYomigana, category, role };
                members.push(newMember);
                added++;
            }
            
            saveToStorage();
            renderMemberList();
            updateStats();
            
            let statusMessage = `å®Œäº†: ${added}ä»¶è¿½åŠ `;
            if (skipped > 0) statusMessage += `, ${skipped}ä»¶é‡è¤‡ã‚¹ã‚­ãƒƒãƒ—`;
            if (errors > 0) statusMessage += `, ${errors}ä»¶ã‚¨ãƒ©ãƒ¼`;
            
            fileStatus.textContent = statusMessage;
            fileStatus.style.color = added > 0 ? 'green' : 'red';
            
            if (added > 0) {
                setTimeout(() => {
                    document.getElementById('fileInput').value = '';
                    hideFileUpload();
                }, 3000);
            }
        }

        // å…¨ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportAllData() {
            const allData = {
                members: members,
                memberData: memberData,
                exportDate: new Date().toISOString(),
                version: "1.0"
            };
            
            const dataStr = JSON.stringify(allData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `BNI_å…¨ãƒ‡ãƒ¼ã‚¿_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‡ºåŠ›ã—ã¾ã—ãŸï¼\nä»–ã®PCã§ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–ã‚Šè¾¼ã‚€ã“ã¨ã§ãƒ‡ãƒ¼ã‚¿ã‚’åŒæœŸã§ãã¾ã™ã€‚');
        }

        // å…¨ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
        function importAllData(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (!confirm('å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šè¾¼ã¿ã¾ã™ã€‚\nç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ãŒã€ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\n\nâ€»äº‹å‰ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚')) {
                event.target.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (!importedData.members || !importedData.memberData) {
                        throw new Error('ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿å½¢å¼ã§ã™');
                    }
                    
                    members = importedData.members;
                    memberData = importedData.memberData;
                    
                    saveToStorage();
                    renderMemberList();
                    updateStats();
                    
                    currentMember = null;
                    document.getElementById('welcomeMessage').style.display = 'block';
                    document.getElementById('memberDetail').classList.remove('active');
                    
                    alert(`ãƒ‡ãƒ¼ã‚¿å–è¾¼å®Œäº†ï¼\n\nãƒ¡ãƒ³ãƒãƒ¼æ•°: ${members.length}äºº\n1to1è¨˜éŒ²: ${Object.keys(memberData).length}ä»¶\n\nç”»é¢ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚`);
                    
                } catch (error) {
                    alert('ãƒ‡ãƒ¼ã‚¿ã®å–ã‚Šè¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                }
                
                event.target.value = '';
            };
            
            reader.readAsText(file);
        }

        // Excelå‡ºåŠ›
        function exportToExcel() {
            const data = [['ID', 'åå‰', 'ã‚ˆã¿ãŒãª', 'ã‚«ãƒ†ã‚´ãƒªãƒ¼', 'å½¹è·', 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹', 'å®Ÿæ–½æ—¥', 'å ´æ‰€', 'äº‹æ¥­å†…å®¹', 'ç†æƒ³çš„ãªç´¹ä»‹å…ˆ', 'ç´¹ä»‹ã§ãã‚‹ã“ã¨', 'æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³', 'ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—æ—¥', 'å„ªå…ˆåº¦', 'ãƒ¡ãƒ¢']];
            
            members.forEach(member => {
                const memberInfo = memberData[member.id] || {};
                data.push([
                    member.id, member.name, member.yomigana, member.category, member.role,
                    memberInfo.status || 'æœªå®Ÿæ–½', memberInfo.meetingDate || '', memberInfo.location || '',
                    memberInfo.businessDetail || '', memberInfo.idealClient || '', memberInfo.canIntroduce || '',
                    memberInfo.nextActions || '', memberInfo.followupDate || '', memberInfo.priority || 'é€šå¸¸',
                    memberInfo.freeNote || ''
                ]);
            });
            
            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, '1to1è¨˜éŒ²');
            XLSX.writeFile(wb, `BNI_1to1è¨˜éŒ²_${new Date().toISOString().split('T')[0]}.xlsx`);
        }

        // äºˆå®šãƒªã‚¹ãƒˆå‡ºåŠ›
        function exportSchedule() {
            const scheduled = members.filter(member => {
                const data = memberData[member.id];
                return data && (data.status === 'scheduled' || data.followupDate);
            });
            
            const data = [['æ—¥ä»˜', 'ãƒ¡ãƒ³ãƒãƒ¼', 'ã‚«ãƒ†ã‚´ãƒªãƒ¼', 'ã‚¿ã‚¤ãƒ—', 'å ´æ‰€', 'ã‚¢ã‚¯ã‚·ãƒ§ãƒ³']];
            
            scheduled.forEach(member => {
                const info = memberData[member.id];
                if (info.status === 'scheduled' && info.meetingDate) {
                    data.push([info.meetingDate, member.name, member.category, '1to1', info.location || '', info.nextActions || '']);
                }
                if (info.followupDate) {
                    data.push([info.followupDate, member.name, member.category, 'ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—', '', info.nextActions || '']);
                }
            });
            
            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'äºˆå®šãƒªã‚¹ãƒˆ');
            XLSX.writeFile(wb, `BNI_äºˆå®šãƒªã‚¹ãƒˆ_${new Date().toISOString().split('T')[0]}.xlsx`);
        }

        // ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¿å­˜
        function saveToStorage() {
            localStorage.setItem('bni_members', JSON.stringify(members));
            localStorage.setItem('bni_member_data', JSON.stringify(memberData));
        }

        // ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸èª­ã¿è¾¼ã¿
        function loadFromStorage() {
            const savedMembers = localStorage.getItem('bni_members');
            const savedData = localStorage.getItem('bni_member_data');
            
            if (savedMembers) {
                members = JSON.parse(savedMembers);
            }
            if (savedData) {
                memberData = JSON.parse(savedData);
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
